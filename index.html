<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Crypto Investments</title>
    <script src="js/modernizr.js" type="text/javascript"></script>
    <script src="js/jquery-3.1.0.min.js"></script>
    <script src="js/index.js"></script>

    <script type="text/javascript">
              var jsonData = "";
      $(document).ready(function() {

        $(".hidden").hide();

        $(document).keyup(function(event) {
          if(event.which === 27) {
            $('.hidden').hide();
          }
        });

        $("#coinNameTextbox").on("click", function() {
          if ($(this).val() == "coin name")
            $(this).val("")
        });

        $("#ownedTextbox").on("click", function() {
          if ($(this).val() == "amount purchased")
            $(this).val("")
        });

        $("#costPerCoinTextbox").on("click", function() {
          if ($(this).val() == "price per coin")
            $(this).val("")
        });

        $("#addInvestment").click(function(){
          $(".hidden").show();
        });

        $("#saveInvestment").click(function(){
          //add element to investments div on button click
          var intRegex = /^\d+$/;
          var floatRegex = /^((\d+(\.\d *)?)|((\d*\.)?\d+))$/;

          var coinID = $('#coinNameTextbox').val();
          var coinsBought = $('#ownedTextbox').val();
          var costPerCoin = $('#costPerCoinTextbox').val();

        if((intRegex.test(coinsBought) || floatRegex.test(coinsBought)) && (intRegex.test(costPerCoin) || floatRegex.test(costPerCoin))){;

          $.ajax({
            url: 'https://api.cryptocoincharts.info/tradingPair/' + coinID +'_usd',
            async: false,
            dataType: 'json',
            success: function (json) {
              jsonData = json;
              console.log(json.id);
              console.log(json.price);
            }
          });

          if (jsonData.id != undefined || jsonData.id != null) {
              console.log("valid id entered");

              var coinsBoughtFloat = parseFloat(coinsBought);
              var costPerCoinFloat = parseFloat(costPerCoin);
              var moneySpent = coinsBoughtFloat*costPerCoinFloat;
              var currentValue = coinsBoughtFloat*jsonData.price //TODO: replace 680 with actual price
              var currentProfit = currentValue-moneySpent;
              var profit = currentProfit.toFixed(2);
              var coinName = jsonData.coin1;
          }
          else{
            $.ajax({
              url: 'https://api.cryptocoincharts.info/tradingPair/' + coinID +'_btc',
              async: false,
              dataType: 'json',
              success: function (json) {
                var coinsBoughtFloat = parseFloat(coinsBought);
                var costPerCoinFloat = parseFloat(costPerCoin);
                var moneySpent = coinsBoughtFloat*costPerCoinFloat;
                var currentValue = coinsBoughtFloat*json.price
                var currentProfit = currentValue-moneySpent;
                var profit = currentProfit.toFixed(2);
                var coinName = json.coin1;
              }
            });
          }

          $("#investmentTable tr:last").after(" <tr> \
            <td data-th='Name'>" + coinName + "</td> \
            <td data-th='Owned'>" + coinsBought + "</td> \
            <td data-th='CostPer'>" + costPerCoin + "</td> \
            <td data-th='Profit'>" + "$" + profit + "</td> \
            </tr> ");
          $(".hidden").hide();
        }else{
          alert('Invalid entry!');
        }
        });
      });
    </script>
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/style.css">
  </head>
<body>
  <h1>Investments</h1>
  <table id="investmentTable" class="rwd-table">
    <tr>
      <th>Name</th>
      <th>Amount Purchased</th>
      <th>Price/Coin</th>
      <th>Profit</th>
    </tr>
    <div class="investments">
    </div>
  </table>
  <a class="btn btn-blue" href="#" id="addInvestment">Add Investment</a>

  <div class="hidden holder" id="investmentScreen">
    <div id="popup" class="popup">
      <div class="content">
        <form>
          <input type="text" class="textbox" id="coinNameTextbox" value="coinmarketcap id" />
          <input type="text" class="textbox" id="ownedTextbox" value="amount purchased" />
          <input type="text" class="textbox" id="costPerCoinTextbox" value="price per coin" />
        </form>
        <div id="bottom-right">
          <a href="#" class="btn btn-blue" id="saveInvestment">Save</a>
        </div>
      </div>
    </div>
  </div>
</body>
</html>